<!DOCTYPE html>
<html>
<head>
  <title>Zency Invoice Report</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Zency Invoice</h1>

    <div id="customerDetails" style="margin-bottom: 20px;"></div>

    <table border="1" width="100%" cellpadding="8" cellspacing="0">
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="itemTable"></tbody>
      <tfoot>
        <tr>
          <td colspan="3" align="right"><b>Grand Total</b></td>
          <td id="grandTotal"></td>
        </tr>
      </tfoot>
    </table>

    <br>
    <button id="sendEmailBtn">üìß Send Invoice to Customer</button>
  </div>

  <!-- EmailJS Library -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // EmailJS init with your public key
    emailjs.init("DwlVJ3pXk1J3yFeuP"); // <-- tumhara public key

    const data = JSON.parse(localStorage.getItem("invoiceData"));
    if (!data) {
      document.body.innerHTML = "<h2>No invoice data found!</h2>";
    } else {
      document.getElementById("customerDetails").innerHTML = `
        <b>Customer Name:</b> ${data.customer} <br>
        <b>Mobile:</b> ${data.mobile} <br>
        <b>Address:</b> ${data.address}
      `;

      let grandTotal = 0;
      let tableRows = "";
      data.items.forEach(item => {
        let total = item.qty * item.price;
        grandTotal += total;
        tableRows += `
          <tr>
            <td>${item.name}</td>
            <td>${item.qty}</td>
            <td>‚Çπ${item.price.toFixed(2)}</td>
            <td>‚Çπ${total.toFixed(2)}</td>
          </tr>
        `;
      });

      document.getElementById("itemTable").innerHTML = tableRows;
      document.getElementById("grandTotal").innerText = "‚Çπ" + grandTotal.toFixed(2);

      document.getElementById("sendEmailBtn").addEventListener("click", function(){
        emailjs.send("service_t1zo7wq", "template_2yyf3mj", {
          customer_name: data.customer,
          mobile_number: data.mobile,
          address: data.address,
          total_amount: grandTotal,
          invoice_details: JSON.stringify(data.items, null, 2)
        }).then(function(response) {
            alert("‚úÖ Invoice sent successfully!");
        }, function(error) {
            alert("‚ùå Failed to send invoice.");
        });
      });
    }
  </script>
</body>
</html>
